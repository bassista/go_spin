<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>go_spin - Container Scheduler</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        [x-cloak] { display: none !important; }
        .tab-active { border-bottom: 2px solid #3b82f6; color: #3b82f6; }
        .modal-backdrop { background-color: rgba(0,0,0,0.5); }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        @media (max-width: 599px) {
            .hide-on-sm { display: none !important; }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div x-data="app()" x-init="init()" x-cloak class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-800">üê≥ go_spin</h1>
            <p class="text-gray-600">Scheduled Docker Container Management</p>
        </header>

        <!-- Error Alert -->
        <div x-show="error" x-transition class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
            <span x-text="error"></span>
            <button @click="error = ''" class="float-right font-bold">&times;</button>
        </div>

        <!-- Success Alert -->
        <div x-show="success" x-transition class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
            <span x-text="success"></span>
            <button @click="success = ''" class="float-right font-bold">&times;</button>
        </div>

        <!-- Tabs -->
        <nav class="flex border-b border-gray-200 mb-6">
            <button @click="activeTab = 'containers'" 
                    :class="activeTab === 'containers' ? 'tab-active' : ''"
                    class="px-4 py-2 font-medium text-gray-600 hover:text-blue-500">
                üì¶ Containers
            </button>
            <button @click="activeTab = 'groups'" 
                    :class="activeTab === 'groups' ? 'tab-active' : ''"
                    class="px-4 py-2 font-medium text-gray-600 hover:text-blue-500">
                üìÅ Groups
            </button>
            <button @click="activeTab = 'schedules'" 
                    :class="activeTab === 'schedules' ? 'tab-active' : ''"
                    class="px-4 py-2 font-medium text-gray-600 hover:text-blue-500">
                ‚è∞ Schedules
            </button>
        </nav>

        <!-- Containers Tab -->
        <div x-show="activeTab === 'containers'" x-transition>
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">Containers</h2>
                <div :class="showStackButtons ? 'flex flex-col items-end space-y-2' : 'space-x-2'">
                    <button @click="refreshContainersWithStats()" :disabled="isContainerRefreshing" :class="isContainerRefreshing ? 'bg-gray-400 cursor-not-allowed' : 'bg-gray-500 hover:bg-gray-600'" class="text-white px-3 py-1 rounded inline-flex items-center">
                        <span :class="isContainerRefreshing ? 'animate-spin' : ''" class="mr-1">üîÑ</span> Refresh
                    </button>
                    <button @click="openContainerModal()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">+ Add Container</button>
                </div>
            </div>
            <!-- Filter UI -->
            <div class="flex gap-4 mb-2">
                <div>
                    <input type="text" placeholder="Filter by Name" x-model="containerFilter.name" class="border rounded px-2 py-1 text-sm" />
                </div>
            </div>
            <div class="bg-white rounded-lg shadow overflow-hidden">
                <table class="min-w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer" @click="sortContainersBy('name')">
                                Name
                                <span x-show="containerSort.key === 'name'" x-text="containerSort.asc ? '‚ñ≤' : '‚ñº'" class="ml-1"></span>
                            </th>
                            <th :class="{ 'hidden': !showMetaColumns }" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer" @click="sortContainersBy('friendly_name')">
                                Friendly Name
                                <span x-show="containerSort.key === 'friendly_name'" x-text="containerSort.asc ? '‚ñ≤' : '‚ñº'" class="ml-1"></span>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase hidden lg:table-cell">URL</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase hidden lg:table-cell">SpinUp</th>
                            <th :class="{ 'hidden': !showMetaColumns }" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer" @click="sortContainersBy('active')">
                                Active
                                <span x-show="containerSort.key === 'active'" x-text="containerSort.asc ? '‚ñ≤' : '‚ñº'" class="ml-1"></span>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer" @click="sortContainersBy('running')">
                                Running
                                <span x-show="containerSort.key === 'running'" x-text="containerSort.asc ? '‚ñ≤' : '‚ñº'" class="ml-1"></span>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer" @click="sortContainersBy('cpu')" :class="{ 'hidden': !showStatsColumns }">
                                CPU %
                                <span x-show="containerSort.key === 'cpu'" x-text="containerSort.asc ? '‚ñ≤' : '‚ñº'" class="ml-1"></span>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer" @click="sortContainersBy('mem')" :class="{ 'hidden': !showStatsColumns }">
                                MEM (MB)
                                <span x-show="containerSort.key === 'mem'" x-text="containerSort.asc ? '‚ñ≤' : '‚ñº'" class="ml-1"></span>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        <template x-for="container in filteredSortedContainers" :key="container.name">
                            <tr @click="openContainerDetails(container)" class="hover:bg-gray-50 cursor-pointer">
                                <td class="px-4 py-3 font-medium" x-text="truncate(container.name,15)"></td>
                                <td :class="{ 'hidden': !showMetaColumns }" class="px-4 py-3" x-text="truncate(container.friendly_name,15)"></td>
                                <td class="px-4 py-3 hidden lg:table-cell">
                                    <a @click.stop :href="container.url" target="_blank" class="text-blue-500 hover:underline" x-text="'open'"></a>
                                </td>
                                <td class="px-4 py-3 hidden lg:table-cell">
                                    <a x-show="generateSpinUpUrl(container.friendly_name)" @click.stop :href="generateSpinUpUrl(container.friendly_name)" target="_blank" class="text-blue-500 hover:underline" x-text="'start'"></a>
                                    <span x-show="!generateSpinUpUrl(container.friendly_name)" class="text-gray-400">-</span>
                                </td>
                                <td :class="{ 'hidden': !showMetaColumns }" class="px-4 py-3">
                                    <span :class="container.active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'" 
                                          class="px-2 py-1 rounded text-xs" x-text="container.active ? 'Yes' : 'No'"></span>
                                </td>
                                <td class="px-4 py-3">
                                    <span :class="container.running ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800'" 
                                          class="px-2 py-1 rounded text-xs" x-text="container.running ? 'Running' : 'Stopped'"></span>
                                </td>
                                <td class="px-4 py-3 text-right" :class="{ 'hidden': !showStatsColumns }">
                                    <span class="text-xs" x-text="getContainerCpu(container.name).toFixed(1)"></span>
                                </td>
                                <td class="px-4 py-3 text-right" :class="{ 'hidden': !showStatsColumns }">
                                    <span class="text-xs" x-text="getContainerMem(container.name).toFixed(1)"></span>
                                </td>
                                <td class="px-4 py-3 space-x-1">
                                    <button @click.stop="openContainerModal(container)" class="text-blue-500 hover:text-blue-700">‚úèÔ∏è</button>
                                    <button @click.stop="deleteContainer(container.name)" class="text-red-500 hover:text-red-700">üóëÔ∏è</button>
                                    <button x-show="!container.running" @click.stop="startContainer(container.name)" class="text-green-500 hover:text-green-700">‚ñ∂Ô∏è</button>
                                    <button x-show="container.running" @click.stop="stopContainer(container.name)" class="text-orange-500 hover:text-orange-700">‚èπÔ∏è</button>
                                </td>
                            </tr>
                        </template>
                        <tr x-show="filteredSortedContainers.length === 0">
                            <td :colspan="9 - (showStatsColumns ? 0 : 2) - (showMetaColumns ? 0 : 2)" class="px-4 py-8 text-center text-gray-500">No containers configured</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Container Details Modal (read-only) -->
        <div x-show="showContainerDetailsModal" class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop" x-transition>
            <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4" @click.away="showContainerDetailsModal = false">
                <div class="px-6 py-4 border-b flex justify-between items-center">
                    <h3 class="text-lg font-semibold">Container Details</h3>
                    <button @click="showContainerDetailsModal = false" class="text-gray-600">&times;</button>
                </div>
                <div class="p-6 space-y-3 text-sm">
                    <div class="flex justify-between">
                        <span class="font-medium">Name</span>
                        <span x-text="detailsContainer.name"></span>
                    </div>
                    <div class="flex justify-between">
                        <span class="font-medium">Friendly Name</span>
                        <span x-text="detailsContainer.friendly_name"></span>
                    </div>
                    <div class="flex justify-between">
                        <span class="font-medium">URL</span>
                        <a @click.stop :href="detailsContainer.url" target="_blank" class="text-blue-500 hover:underline" x-text="detailsContainer.url"></a>
                    </div>
                    <div class="flex justify-between">
                        <span class="font-medium">SpinUp</span>
                        <template x-if="generateSpinUpUrl(detailsContainer.friendly_name)">
                            <a @click.stop :href="generateSpinUpUrl(detailsContainer.friendly_name)" target="_blank" class="text-blue-500 hover:underline" x-text="generateSpinUpUrl(detailsContainer.friendly_name)"></a>
                        </template>
                        <template x-if="!generateSpinUpUrl(detailsContainer.friendly_name)">
                            <span class="text-gray-400">-</span>
                        </template>
                    </div>
                    <div class="flex justify-between">
                        <span class="font-medium">Active</span>
                        <span x-text="detailsContainer.active ? 'Yes' : 'No'"></span>
                    </div>
                    <div class="flex justify-between">
                        <span class="font-medium">Running</span>
                        <span x-text="detailsContainer.running ? 'Running' : 'Stopped'"></span>
                    </div>
                    <div class="flex justify-between">
                        <span class="font-medium">CPU %</span>
                        <span x-text="getContainerCpu(detailsContainer.name).toFixed(1)"></span>
                    </div>
                    <div class="flex justify-between">
                        <span class="font-medium">MEM (MB)</span>
                        <span x-text="getContainerMem(detailsContainer.name).toFixed(1)"></span>
                    </div>
                    <div class="flex justify-end pt-4">
                        <button @click="showContainerDetailsModal = false" class="px-4 py-2 border rounded hover:bg-gray-50">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Groups Tab -->
        <div x-show="activeTab === 'groups'" x-transition>
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">Groups</h2>
                <div :class="showStackButtons ? 'flex flex-col items-end space-y-2' : 'space-x-2'">
                    <button @click="loadGroups()" :class="isContainerRefreshing ? 'bg-gray-400 cursor-not-allowed' : 'bg-gray-500 hover:bg-gray-600'" class="text-white px-3 py-1 rounded">üîÑ Refresh</button>
                    <button @click="openGroupModal()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">+ Add Group</button>
                </div>
            </div>
            <!-- Filter UI -->
            <div class="flex gap-4 mb-2">
                <div>
                    <input type="text" placeholder="Filter by Name" x-model="groupFilter.name" class="border rounded px-2 py-1 text-sm" />
                </div>
            </div>
            <div class="bg-white rounded-lg shadow overflow-hidden">
                <table class="min-w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer" @click="sortGroupsBy('name')">
                                Name
                                <span x-show="groupSort.key === 'name'" x-text="groupSort.asc ? '‚ñ≤' : '‚ñº'" class="ml-1"></span>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Containers</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hide-on-sm" @click="sortGroupsBy('active')">
                                Active
                                <span x-show="groupSort.key === 'active'" x-text="groupSort.asc ? '‚ñ≤' : '‚ñº'" class="ml-1"></span>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        <template x-for="group in filteredSortedGroups" :key="group.name">
                            <tr>
                                <td class="px-4 py-3 font-medium" x-text="truncate(group.name,20)" :title="group.name"></td>
                                <td class="px-4 py-3">
                                    <div class="flex flex-wrap gap-1">
                                        <template x-for="c in group.container" :key="c">
                                            <span :class="isContainerRunning(c) ? 'bg-green-100 text-green-800 px-2 py-1 rounded text-xs' : 'bg-gray-200 px-2 py-1 rounded text-xs'" x-text="c"></span>
                                        </template>
                                    </div>
                                </td>
                                <td class="px-4 py-3 hide-on-sm">
                                    <span :class="group.active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'" 
                                          class="px-2 py-1 rounded text-xs" x-text="group.active ? 'Yes' : 'No'"></span>
                                </td>
                                <td class="px-4 py-3 space-x-1">
                                    <button @click="openGroupModal(group)" class="text-blue-500 hover:text-blue-700">‚úèÔ∏è</button>
                                    <button @click="deleteGroup(group.name)" class="text-red-500 hover:text-red-700">üóëÔ∏è</button>
                                    <button @click="startGroup(group.name)" class="text-green-500 hover:text-green-700" title="Start all containers">‚ñ∂Ô∏è</button>
                                    <button @click="stopGroup(group.name)" class="text-orange-500 hover:text-orange-700" title="Stop all containers">‚èπÔ∏è</button>
                                </td>
                            </tr>
                        </template>
                        <tr x-show="filteredSortedGroups.length === 0">
                            <td colspan="4" class="px-4 py-8 text-center text-gray-500">No groups configured</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Schedules Tab -->
        <div x-show="activeTab === 'schedules'" x-transition>
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">Schedules</h2>
                <div :class="showStackButtons ? 'flex flex-col items-end space-y-2' : 'space-x-2'">
                    <button @click="loadSchedules()" class="bg-gray-500 text-white px-3 py-1 rounded hover:bg-gray-600">üîÑ Refresh</button>
                    <button @click="openScheduleModal()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">+ Add Schedule</button>
                </div>
            </div>
            
            <div class="space-y-4">
                <template x-for="schedule in schedules" :key="schedule.id">
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h3 class="font-semibold text-lg">
                                    <span x-text="truncate(schedule.target,20)" :title="schedule.target"></span>
                                    <span class="text-sm font-normal text-gray-500" x-text="'(' + schedule.targetType + ')'"></span>
                                </h3>
                                <p class="text-xs text-gray-400" x-text="'ID: ' + schedule.id"></p>
                            </div>
                            <div class="space-x-1">
                                <button @click="openScheduleModal(schedule)" class="text-blue-500 hover:text-blue-700">‚úèÔ∏è</button>
                                <button @click="deleteSchedule(schedule.id)" class="text-red-500 hover:text-red-700">üóëÔ∏è</button>
                            </div>
                        </div>
                        
                        <div x-show="schedule.timers && schedule.timers.length > 0">
                            <h4 class="text-sm font-medium text-gray-600 mb-2">Timers:</h4>
                            <div class="space-y-2">
                                <template x-for="(timer, idx) in schedule.timers" :key="idx">
                                    <div class="bg-gray-50 rounded p-3 text-sm">
                                        <div class="flex items-center gap-4">
                                            <span :class="timer.active ? 'text-green-600' : 'text-gray-400'">
                                                <span x-text="timer.active ? '‚úÖ' : '‚è∏Ô∏è'"></span>
                                            </span>
                                            <span class="font-mono">
                                                <span x-text="timer.startTime"></span> ‚Üí <span x-text="timer.stopTime"></span>
                                            </span>
                                            <span class="text-gray-500" x-text="formatDays(timer.days)"></span>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                        <div x-show="!schedule.timers || schedule.timers.length === 0" class="text-gray-400 text-sm">
                            No timers configured
                        </div>
                    </div>
                </template>
                <div x-show="schedules.length === 0" class="bg-white rounded-lg shadow p-8 text-center text-gray-500">
                    No schedules configured
                </div>
            </div>
        </div>

        <!-- Container Modal -->
        <div x-show="showContainerModal" class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop" x-transition>
            <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4" @click.away="showContainerModal = false">
                <div class="px-6 py-4 border-b">
                    <h3 class="text-lg font-semibold" x-text="editingContainer ? 'Edit Container' : 'Add Container'"></h3>
                </div>
                <form @submit.prevent="saveContainer()" class="p-6 space-y-4">
                    <div class="relative">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Name *</label>
                        <template x-if="editingContainer">
                            <input type="text" x-model="containerForm.name" disabled required
                                   class="w-full border rounded px-3 py-2 bg-gray-100">
                        </template>
                        <template x-if="!editingContainer">
                            <div class="relative">
                                <input type="text" x-model="containerForm.name" required
                                       @input="filterContainerSuggestions()"
                                       @focus="showContainerSuggestions = true"
                                       @click="showContainerSuggestions = true"
                                       autocomplete="off"
                                       placeholder="Type to search containers..."
                                       class="w-full border rounded px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                                <div x-show="showContainerSuggestions && filteredRuntimeContainers.length > 0" 
                                     x-transition
                                     @click.away="showContainerSuggestions = false"
                                     class="absolute z-10 w-full mt-1 bg-white border rounded-lg shadow-lg max-h-48 overflow-y-auto">
                                    <template x-for="name in filteredRuntimeContainers" :key="name">
                                        <button type="button" 
                                                @click="selectContainerName(name)"
                                                class="w-full text-left px-3 py-2 hover:bg-blue-50 focus:bg-blue-50 focus:outline-none text-sm"
                                                x-text="name">
                                        </button>
                                    </template>
                                </div>
                                <div x-show="showContainerSuggestions && filteredRuntimeContainers.length === 0 && runtimeContainers.length > 0"
                                     class="absolute z-10 w-full mt-1 bg-white border rounded-lg shadow-lg p-3 text-sm text-gray-500">
                                    No matching containers found
                                </div>
                                <div x-show="showContainerSuggestions && runtimeContainers.length === 0"
                                     class="absolute z-10 w-full mt-1 bg-white border rounded-lg shadow-lg p-3 text-sm text-gray-500">
                                    No containers available from Docker runtime
                                </div>
                            </div>
                        </template>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Friendly Name *</label>
                        <input type="text" x-model="containerForm.friendly_name" required
                               class="w-full border rounded px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">URL *</label>
                        <input type="url" x-model="containerForm.url" required
                               class="w-full border rounded px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div class="flex gap-6">
                        <label class="flex items-center">
                            <input type="checkbox" x-model="containerForm.active" class="rounded mr-2">
                            <span class="text-sm">Active</span>
                        </label>

                    </div>
                    <div class="flex justify-end gap-2 pt-4">
                        <button type="button" @click="showContainerModal = false" class="px-4 py-2 border rounded hover:bg-gray-50">Cancel</button>
                        <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Save</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Group Modal -->
        <div x-show="showGroupModal" class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop" x-transition>
            <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4" @click.away="showGroupModal = false">
                <div class="px-6 py-4 border-b">
                    <h3 class="text-lg font-semibold" x-text="editingGroup ? 'Edit Group' : 'Add Group'"></h3>
                </div>
                <form @submit.prevent="saveGroup()" class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Name *</label>
                        <input type="text" x-model="groupForm.name" :disabled="editingGroup" required
                               class="w-full border rounded px-3 py-2 focus:ring-blue-500 focus:border-blue-500"
                               :class="editingGroup ? 'bg-gray-100' : ''">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Containers</label>
                        <div class="space-y-2 max-h-48 overflow-y-auto border rounded p-2">
                            <template x-for="c in containers" :key="c.name">
                                <label class="flex items-center">
                                    <input type="checkbox" :value="c.name" 
                                           :checked="groupForm.container.includes(c.name)"
                                           @change="toggleGroupContainer(c.name)"
                                           class="rounded mr-2">
                                    <span class="text-sm" x-text="c.name"></span>
                                </label>
                            </template>
                        </div>
                    </div>
                    <div>
                        <label class="flex items-center">
                            <input type="checkbox" x-model="groupForm.active" class="rounded mr-2">
                            <span class="text-sm">Active</span>
                        </label>
                    </div>
                    <div class="flex justify-end gap-2 pt-4">
                        <button type="button" @click="showGroupModal = false" class="px-4 py-2 border rounded hover:bg-gray-50">Cancel</button>
                        <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Save</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Schedule Modal (Full Editor) -->
        <div x-show="showScheduleModal" class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop overflow-y-auto" x-transition>
            <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4 my-8" @click.away="showScheduleModal = false">
                <div class="px-6 py-4 border-b">
                    <h3 class="text-lg font-semibold" x-text="editingSchedule ? 'Edit Schedule' : 'Add Schedule'"></h3>
                </div>
                <form @submit.prevent="saveSchedule()" class="p-6 space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Target Type *</label>
                                <select x-model="scheduleForm.targetType" required @change="onScheduleTargetTypeChange()"
                                    class="w-full border rounded px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="container">Container</option>
                                <option value="group">Group</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Target *</label>
                            <select x-model="scheduleForm.target" required
                                    class="w-full border rounded px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                                <template x-if="scheduleForm.targetType === 'container'">
                                    <template x-for="c in containers" :key="c.name">
                                        <option :value="c.name" x-text="c.name"></option>
                                    </template>
                                </template>
                                <template x-if="scheduleForm.targetType === 'group'">
                                    <template x-for="g in groups" :key="g.name">
                                        <option :value="g.name" x-text="g.name"></option>
                                    </template>
                                </template>
                            </select>
                        </div>
                    </div>
                    
                    <div x-show="editingSchedule" class="text-sm text-gray-500">
                        ID: <span x-text="scheduleForm.id"></span>
                    </div>

                    <!-- Timers Section -->
                    <div class="border-t pt-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="font-medium">Timers</h4>
                            <button type="button" @click="addTimer()" class="text-sm bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600">+ Add Timer</button>
                        </div>
                        
                        <div class="space-y-4">
                            <template x-for="(timer, timerIdx) in scheduleForm.timers" :key="timerIdx">
                                <div class="bg-gray-50 rounded-lg p-4 relative">
                                    <button type="button" @click="removeTimer(timerIdx)" 
                                            class="absolute top-2 right-2 text-red-500 hover:text-red-700 text-lg">√ó</button>
                                    
                                    <div class="grid grid-cols-3 gap-4 mb-3">
                                        <div>
                                            <label class="block text-xs font-medium text-gray-600 mb-1">Start Time *</label>
                                            <input type="time" x-model="timer.startTime" required
                                                   class="w-full border rounded px-2 py-1 text-sm">
                                        </div>
                                        <div>
                                            <label class="block text-xs font-medium text-gray-600 mb-1">Stop Time *</label>
                                            <input type="time" x-model="timer.stopTime" required
                                                   class="w-full border rounded px-2 py-1 text-sm">
                                        </div>
                                        <div class="flex items-end">
                                            <label class="flex items-center">
                                                <input type="checkbox" x-model="timer.active" class="rounded mr-2">
                                                <span class="text-sm">Active</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-xs font-medium text-gray-600 mb-2">Days</label>
                                        <div class="flex flex-wrap gap-2">
                                            <template x-for="(dayName, dayIdx) in dayNames" :key="dayIdx">
                                                <label class="flex items-center bg-white border rounded px-3 py-1 cursor-pointer hover:bg-blue-50"
                                                       :class="timer.days.includes(dayIdx) ? 'border-blue-500 bg-blue-50' : ''">
                                                    <input type="checkbox" :checked="timer.days.includes(dayIdx)"
                                                           @change="toggleTimerDay(timerIdx, dayIdx)"
                                                           class="sr-only">
                                                    <span class="text-sm" x-text="dayName"></span>
                                                </label>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            
                            <div x-show="scheduleForm.timers.length === 0" class="text-center text-gray-400 py-4">
                                No timers added. Click "+ Add Timer" to create one.
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-end gap-2 pt-4 border-t">
                        <button type="button" @click="showScheduleModal = false" class="px-4 py-2 border rounded hover:bg-gray-50">Cancel</button>
                        <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Save</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Confirmation Modal -->
        <div x-show="showConfirmModal" class="fixed inset-0 z-60 flex items-center justify-center modal-backdrop" x-transition>
            <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4" @click.away="_confirmResolve && _confirmResolve(false)">
                <div class="px-6 py-4 border-b flex justify-between items-center">
                    <h3 class="text-lg font-semibold" x-text="confirmTitle"></h3>
                    <button @click="_confirmResolve && _confirmResolve(false)" class="text-gray-600">&times;</button>
                </div>
                <div class="p-6 space-y-4 text-sm">
                    <p class="text-gray-700" x-text="confirmMessage"></p>
                    <div class="flex justify-end gap-2 pt-4">
                        <button type="button" @click="_confirmResolve && _confirmResolve(false)" class="px-4 py-2 border rounded hover:bg-gray-50">Cancel</button>
                        <button type="button" @click="_confirmResolve && _confirmResolve(true)" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Confirm</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="/ui/assets/app.js"></script>
</body>
</html>
